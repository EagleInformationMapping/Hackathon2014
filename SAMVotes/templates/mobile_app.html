<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SAM Votes!</title>
    <link rel="stylesheet" href="http://js.arcgis.com/3.8/js/esri/css/esri.css">
{#    <link rel="stylesheet" href="http://js.arcgis.com/3.8/js/dojo/dijit/themes/claro/claro.css">#}

    <style>
        html, body, .mblView {
          height: 100%;
          margin: 0px;
          padding: 0px;
          width: 100%;
        }

        #mapView {
          height:	100%;
        }

        #map {
          position:relative;
          width:	100%;
          height:	100%;
        }


    </style>

    <script>var dojoConfig = { mblAlwaysHideAddressBar: true };</script>
    <script src="http://js.arcgis.com/3.8compact"></script>
    <script>
        var map;
        require([
            "esri/map", "dojox/mobile", "dojox/mobile/parser", "esri/sniff",
            "dojox/mobile/deviceTheme", "dojo/dom", "dijit/registry", "dojo/on",
            "esri/layers/ArcGISDynamicMapServiceLayer", "esri/geometry/Extent", "esri/geometry/Point",
            "dojox/mobile/ToolBarButton", "dojox/mobile/View", "dojox/mobile/ContentPane"
        ], function(Map, mobile, parser, has, dTheme, dom, registry, on, ArcGISDynamicMapServiceLayer, Extent, Point) {
            parser.parse();
            mobile.hideAddressBar();

            if (navigator.geolocation) {
              // if you want to track as the user moves setup navigator.geolocation.watchPostion
              navigator.geolocation.getCurrentPosition(get_location, get_location_error);
            }

            map = new Map("map", {
              //center: [-56.049, 38.485],
              //zoom: 3,
                extent: new Extent({xmin:-13204343.762204075,ymin:3908072.382163536,xmax:-12771404.433997044,ymax:4149919.139657717,spatialReference:{wkid:102100}}),
                basemap: "streets"
                });
            map.on("load", map_loaded);

            var resizeEvt = (window.onorientationchange !== undefined && !has('android')) ? "orientationchange" : "resize";
            on(window, resizeEvt, resize_map);

            function map_loaded()
            {
                var supervisor_layer = new ArcGISDynamicMapServiceLayer("http://www.rctlma.org/siteadmin/rest/services/Public/Supervisorial_Districts/MapServer", {opacity:.25});
                map.addLayer(supervisor_layer);
                //http://services1.arcgis.com/CbqvrXravyhsUGrp/arcgis/rest/services/VotingLocations/FeatureServer/0
            }

            function get_location(position)
            {
                //
                zoomToLocation(position);
            }

            function zoomToLocation(position) {
                //$.mobile.hidePageLoadingMsg(); //true hides the dialog
                var pt = esri.geometry.geographicToWebMercator(new Point(position.coords.longitude, position.coords.latitude));
                map.centerAndZoom(pt, 13);
                //uncomment to add a graphic at the current location
                //var symbol = new PictureMarkerSymbol("images/bluedot.png", 40, 40);
                //map.graphics.add(new Graphic(pt, symbol));
                console.dir(position);
              }

            function get_location_error(error)
            {
                console.log("Error getting location");
                console.log(error);
            }

            function resize_map() {
              mobile.hideAddressBar();
              adjustMapHeight();
              map.resize();
              map.reposition();
            }

            function adjustMapHeight() {
              var availHeight = mobile.getScreenSize().h - registry.byId('header').domNode.clientHeight - 1;
              if (has('iphone') || has('ipod')) {
                availHeight += iphoneAdjustment();
              }
              dom.byId("map").style.height = availHeight + "px";
            }

            function iphoneAdjustment() {
              var sz = mobile.getScreenSize();
              if (sz.h > sz.w) { //portrait
                //Need to add address bar height back to map
                 return screen.availHeight - window.innerHeight - 40; /* 40 = height of bottom safari toolbar */
              } else { //landscape
                //Need to react to full screen / bottom bar visible toggles
                var _conn = on(window, 'resize', function() {
                  _conn.remove();
                  resizeMap();
                });
                return 0;
              }
            }


        });




    </script>
</head>
<body>
    <div id="mapView" data-dojo-type="dojox.mobile.View" data-dojo-props="selected: true">
      <div id="header" data-dojo-type="dojox.mobile.Heading">
        <div id="updateMeButton" data-dojo-type="dojox.mobile.ToolBarButton" style="float: right;" moveTo="aboutView">Update Me!</div>
        <div id="aboutButton" data-dojo-type="dojox.mobile.ToolBarButton" style="float: right;" moveTo="aboutView">About</div>
      </div>
      <div id="mapContainer" data-dojo-type="dojox.mobile.ContentPane">
        <div id="map"></div>
      </div>
    </div>

    <div id="aboutView" data-dojo-type="dojox.mobile.View">
      <h1 data-dojo-type="dojox.mobile.Heading" data-dojo-props="back:'Map', moveTo:'mapView'">About</h1>
      <p style="padding: 5px;">This area can contain additional information about your application.</p>
      <p>Ex quorum ab quorum non senserit magna se litteris firmissimum. Pariatur fore
      elit do dolor, eram vidisse id proident, nam anim ea multos, ab multos offendit.
      Labore coniunctione senserit legam commodo. Aut in voluptatibus, ab singulis
      consectetur iis e culpa enim ad quamquam ubi ita amet quibusdam. Quis iudicem e
      nostrud, in veniam varias nisi admodum, eiusmod esse quamquam arbitror sed dolor
      eruditionem commodo eram consequat. Esse cupidatat te culpa nisi. Vidisse lorem
      minim ab nulla.
      </p>
    </div>


</body>
</html>